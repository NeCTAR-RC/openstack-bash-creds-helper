#!/bin/bash
# shellcheck disable=SC1090


function chcreds() {
    local tmpfile
    tmpfile=$(mktemp)
    # Ensure GPG pinentry can use the current tty for passphrase prompting
    # and forward diagnostics to the terminal instead of hiding them.
    export GPG_TTY=$(tty)
    if oscreds "$@" > "$tmpfile" 2>/dev/tty; then
        source "$tmpfile"
        rm "$tmpfile"
        echo "Credentials loaded for $OS_CRED"
    else
        rm "$tmpfile"
        echo "Failed to load credentials"
        return 1
    fi
}

function rmcreds() {
    for v in $(env | grep -E '^OS_' | sed 's/=.*//'); do
      unset "$v"
    done
}

function prcreds {
    env | awk -F'[=_]' '/^OS_/ {if ($2 == "PASSWORD" || $2 == "TOKEN") print "OS_"$2"=******" ; else print $0}'
}

# Function useful for adding to your bash prompt
function os_creds {
    [ -z "$OS_CRED" ] || echo " $OS_CRED"
}

# vim:syntax=sh
